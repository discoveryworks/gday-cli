# gday-cli v1.6.1 - Oura Sleep Data Accuracy Fixes

Critical bug fixes for Oura sleep data accuracy and session selection.

## What's Fixed

### üêõ **Sleep Duration Calculation Bug**
**Before:** gday showed 9:28 sleep (time spent in bed)  
**After:** gday shows 6:16 sleep (actual sleep time)

- **Root cause**: Used `time_in_bed` instead of `total_sleep_duration` from Oura API
- **Impact**: 1h+ discrepancies between displayed and actual sleep time  
- **Fix**: Now uses Oura's precise sleep measurements that exclude awake periods

### üïí **Sleep Session Selection Bug** 
**Before:** gday showed sleep from 2 nights ago (longest duration)  
**After:** gday shows sleep from last night (most recent)

- **Root cause**: Selected sessions by longest sleep duration instead of most recent date
- **Impact**: Showing 8:03 sleep from Aug 23 instead of 6:16 sleep from Aug 24 (last night)
- **Fix**: Now selects most recent night's sleep, not best night's sleep

### üõ°Ô∏è **Comprehensive Test Coverage**
- Bug-specific prevention tests with exact values from user issues
- Session selection logic tests preventing old night data display
- Data consistency validation to catch similar problems

## Real-World Impact

Your sleep data now shows **last night**, not your **best recent night**:
```
Before: Sleep onset 10:54PM, wake 8:22AM, 8:03 sleep (2 nights ago)
After:  Sleep onset 12:26AM, wake 8:01AM, 6:16 sleep (last night) ‚úÖ
```

## Migration Notes

- **No action needed** - fixes apply automatically
- **No breaking changes** - all other functionality unchanged  
- Sleep data now reflects your actual recent sleep patterns

---

This patch ensures gday shows your most recent sleep data with accurate duration measurements.